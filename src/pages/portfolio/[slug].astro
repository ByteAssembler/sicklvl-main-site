---
export const prerender = false;

import { redirect } from 'src/utils/minis.ts'

import LayoutExtended from 'src/layouts/LayoutExtended.astro'

import PerfectImage from 'src/components/perfect-image.astro';



import { getPortfolioWithInfos } from 'src/utils/portfolio';
import Button from 'src/components/button.astro';
import PortfolioShowMore from 'src/wrappers/portfolio-show-more.astro';

const redirectToURL = "/";

const { slug } = Astro.params;
if (!slug) return redirect(redirectToURL);

const props = await getPortfolioWithInfos(slug);
if (!props) return redirect(redirectToURL);
---

<LayoutExtended tabTitle={props.current.title}>
	<div class="absolute inset-0 h-full w-full flex items-center justify-center select-none" aria-hidden="true">
		<div class="px-5 md:px-10">
			<span class="drop-shadow-lg block max-w-full text-wrap font-august text-center text-[12vw] 2xl:text-[180px] leading-[120%] font-bold tracking-[13px] uppercase whitespace-nowrap" title={props.current.title}>
				{props.current.title}
			</span>
		</div>
	</div>

	<dialog id="portfolio-showcase" class="appear max-h-screen max-w-[100vw] h-full w-full p-0 m-0">
		<Button class="fixed top-4 right-4 z-[110] bg-yellow-300" onclick="this.closest('dialog').close()">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
		</Button>
		<PortfolioShowMore {...props.current} />
	</dialog>

	<div class="absolute inset-0 h-full w-full overflow-hidden">
		<div
			id="portfolio-taskbar"
			class:list={[
				"absolute bottom-0 left-0 right-0",
				"bg-gradient-to-t from-black to-transparent",
				"overflow-hidden pt-[120px] flex box-content h-24",
				"[&>*]:pt-[30px] [&>*]:pb-[33px] [&>*]:px-10",
				"[&>*]:overflow-hidden",
				"[&_.extra-padding]:px-10",
				"[&>*]:border-t-2 [&>*+*]:border-l-2 [&>*]:border-[rgba(255,255,255,0.1)] [&>*+*]:border-[rgba(255,255,255,0.1)]",
				"[&>*]:relative [&>*>*]:absolute [&>*>*]:inset-0",

				"LG:[&>*]:border-l-0",

				"[&_.content]:flex [&_.content]:items-center [&_.content]:justify-center",
				"[&_.bg]:bg-white [&_.bg]:h-full [&_.bg]:w-full [&_.bg]:absolute [&_.bg]:inset-0 [&_.bg]:transition-all [&_.bg]:duration-200 [&_.bg]:ease",

				"portfolio-taskbar-small-screen animation-bottom-fade-in",
			]}
		>

			<a class="portfolio-taskbar--back group min-w-fit max-w-20" href="/">
				<div class="bg transform translate-y-[100%] group-hover:translate-y-[0%]"></div>
				<div class="content group-hover:[&_*]:fill-black group-hover:[&_*]:text-black">
					<svg width="20" height="20" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
						<g clip-path="url(#clip0_19_2)">
						<rect width="2" height="2" fill="white"/>
						<rect x="4" width="2" height="2" fill="white"/>
						<rect x="8" width="2" height="2" fill="white"/>
						<rect y="4" width="2" height="2" fill="white"/>
						<rect x="4" y="4" width="2" height="2" fill="white"/>
						<rect x="8" y="4" width="2" height="2" fill="white"/>
						<rect y="8" width="2" height="2" fill="white"/>
						<rect x="4" y="8" width="2" height="2" fill="white"/>
						<rect x="8" y="8" width="2" height="2" fill="white"/>
						</g>
						<defs>
						<clipPath id="clip0_19_2">
						<rect width="10" height="10" fill="white"/>
						</clipPath>
						</defs>
					</svg>
				</div>
			</a>

			<div class="portfolio-taskbar--menu min-w-[30%] overflow-hidden">
				<div class="content">
					<h1 class="font-august text-4xl leading-[120%] font-bold tracking-[3px] uppercase whitespace-nowrap" title={props.current.title}>
						{props.current.title}
					</h1>
				</div>
			</div>

			<button id="portfolio-taskbar-show-more-btn" class="portfolio-taskbar--buttons select-none group min-w-56 max-w-64">
				<div class="bg transform translate-y-[100%] group-hover:translate-y-[0%]"></div>
				<div class="content group-hover:[&_*]:fill-black group-hover:[&_*]:text-black">
					<span class="font-inconsolata text-lg font-bold uppercase tracking-widest">
						SHOW MORE
					</span>
				</div>
			</button>
			{/*
			<button class="select-none group min-w-56 max-w-64">
				<div class="bg transform translate-y-[100%] group-hover:translate-y-[0%]"></div>
				<div class="content group-hover:[&_*]:fill-black group-hover:[&_*]:text-black">
					<span class="font-inconsolata text-lg font-bold uppercase tracking-widest">
						SHOW GALLERY
					</span>
				</div>
			</button>
			*/}

			<div class="portfolio-taskbar--description min-w-64 w-full overflow-hidden">
				<div class="content extra-padding">
					<p class="truncate font-inconsolata text-lg font-bold uppercase tracking-widest" title={props.current.description}>
						{props.current.description}
					</p>
				</div>
			</div>

			<div class="portfolio-taskbar--stage min-w-32 w-fit max-w-40">
				<div class="content">
					<span class="truncate font-inconsolata text-lg font-bold uppercase tracking-widest" title={props.current_portfolio_count + " out of " + props.max_portfolio_count}>
						{props.current_portfolio_count} / {props.max_portfolio_count}
					</span>
				</div>
			</div>

			<a class="portfolio-taskbar--left group min-w-fit max-w-20" href={"/portfolio/" + props.prev.slug} title={props.prev.title}>
				<div class="bg transform translate-y-[100%] group-hover:translate-y-[0%]"></div>
				<div class="content group-hover:[&_*]:fill-black group-hover:[&_*]:text-black">
					<svg width="11" height="19" viewBox="0 0 11 19" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M2.15859e-05 9.59603L0.725647 8.80166L8.46565 0.191658L10.4141 1.78041L3.38614 9.59583L10.4141 17.4112L8.46565 19L0.725647 10.39L2.15859e-05 9.59603Z" fill="white"/>
					</svg>
				</div>
			</a>
			<a class="portfolio-taskbar--right group min-w-fit max-w-20" href={"/portfolio/" + props.next.slug} title={props.next.title}>
				<div class="bg transform translate-y-[100%] group-hover:translate-y-[0%]"></div>
				<div class="content group-hover:[&_*]:fill-black group-hover:[&_*]:text-black">
					<svg width="11" height="19" viewBox="0 0 11 19" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path d="M10.414 9.59604L9.68841 8.80166L1.94842 0.191661L-7.94201e-07 1.78041L7.02792 9.59583L-7.32762e-08 17.4113L1.94842 19L9.68841 10.39L10.414 9.59604Z" fill="white"/>
					</svg>
				</div>
			</a>
		</div>
	</div>


	<PerfectImage class="h-full w-full object-cover select-none" images={props.current.image_horizontal} alt={props.current.title}>
	</PerfectImage>
</LayoutExtended>

<script>
	const portfolioTaskbar = document.getElementById("portfolio-taskbar");
	const showMoreBtn = document.getElementById("portfolio-taskbar-show-more-btn");
	const dialog: HTMLDialogElement | null = document.getElementById("portfolio-showcase") as HTMLDialogElement;

	const navigationTopLeft = document.getElementById("navigation-top-left");
	const navigationTopRight = document.getElementById("navigation-top-right");

	function openShowMoreDialog() {
		dialog?.classList.remove("disappear");
		dialog?.classList.add("appear");

		portfolioTaskbar?.classList.remove("animation-bottom-fade-in");
		portfolioTaskbar?.classList.add("animation-bottom-fade-out");

		navigationTopLeft?.classList.remove("animation-top-fade-in");
		navigationTopLeft?.classList.add("animation-top-fade-out");

		navigationTopRight?.classList.remove("animation-top-fade-in");
		navigationTopRight?.classList.add("animation-top-fade-out");

		dialog?.showModal();
	}

	function closeShowMoreDialog() {
		dialog?.classList.remove("appear");
		dialog?.classList.add("disappear");

		portfolioTaskbar?.classList.add("animation-bottom-fade-in");
		portfolioTaskbar?.classList.remove("animation-bottom-fade-out");

		navigationTopLeft?.classList.add("animation-top-fade-in");
		navigationTopLeft?.classList.remove("animation-top-fade-out");

		navigationTopRight?.classList.add("animation-top-fade-in");
		navigationTopRight?.classList.remove("animation-top-fade-out");

		setTimeout(() => dialog?.close(), 500);
	}

	showMoreBtn?.addEventListener("click", openShowMoreDialog);

	// On dialog close event
	dialog?.addEventListener("close", closeShowMoreDialog);
</script>

<style is:global>
	main {
		overflow: hidden;
	}

	.portfolio-taskbar--menu { grid-area: portfolio-taskbar--menu; }
	.portfolio-taskbar--description { grid-area: portfolio-taskbar--description; }
	.portfolio-taskbar--buttons { grid-area: portfolio-taskbar--buttons; }
	.portfolio-taskbar--left { grid-area: portfolio-taskbar--left; }
	.portfolio-taskbar--right { grid-area: portfolio-taskbar--right; }
	.portfolio-taskbar--back { grid-area: portfolio-taskbar--back; }
	.portfolio-taskbar--stage { grid-area: portfolio-taskbar--stage; }

	.portfolio-taskbar--stage {
		display: none;
	}

	@media (max-width: 1024px) {
		.portfolio-taskbar-small-screen {
			display: grid !important;
			grid-template-columns: 1fr 1fr 1fr;
			grid-template-rows: 1fr 1fr 1fr 1fr;
			grid-auto-columns: 1fr;
			gap: 0px 0px;
			grid-auto-flow: row;
			grid-template-areas:
				"portfolio-taskbar--menu portfolio-taskbar--menu portfolio-taskbar--menu"
				"portfolio-taskbar--description portfolio-taskbar--description portfolio-taskbar--description"
				"portfolio-taskbar--buttons portfolio-taskbar--buttons portfolio-taskbar--buttons"
				"portfolio-taskbar--left portfolio-taskbar--back portfolio-taskbar--right";
			overflow: auto;
			height: unset;
		}

		.portfolio-taskbar-small-screen > * {
			max-width: unset;
		}
	}
</style>

<style scoped>
	@keyframes appear {
		from { opacity: 0; }
		to { opacity: 1; }
	}

	@keyframes disappear {
		from { opacity: 1; }
		to { opacity: 0; }
	}

	dialog {
		background-color: black;
		opacity: 0;
	}

	dialog.appear {
		animation-name: appear;
		animation-delay: 250ms;
		animation-duration: 500ms;
		animation-timing-function: ease-out;
		animation-fill-mode: forwards;
		animation-iteration-count: 1;
	}

	dialog.disappear {
		animation-name: disappear;
		animation-delay: 0ms;
		animation-duration: 500ms;
		animation-timing-function: ease-in;
		animation-fill-mode: forwards;
		animation-iteration-count: 1;
	}
</style>
