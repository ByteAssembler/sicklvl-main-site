---
import LayoutAdmin from "src/layouts/LayoutAdmin.astro";
import FunctionalFieldset from "src/components/functional-fieldset.astro";
import Button from "src/components/button.astro";

import { prismaClient } from "src/global";
import { redirectAdminLogin } from "src/utils/minis";

if (!Astro.locals.admin) return redirectAdminLogin();

const customer = await prismaClient.customer.findMany({
	select: {
		id: true,
		name: true,
		description: true,
		boxes: {
			select: { id: true }
		}
	},
	orderBy: { name: "asc" },
});
---

<LayoutAdmin tabTitle="Customer">
	<FunctionalFieldset
		title="Create Customer"
		form
		formAction="/api/customer-create"
		formMethod="post"
		submit
		entries={[
			{ type: "text", title: "Name*", placeholder: "Enter customer's name", name: "name", required: true },
			{ type: "text", title: "Description", placeholder: "Enter customer's description", name: "description" },
			{ type: "email", title: "Email*", placeholder: "Enter customer's email", name: "email", required: true },
			{ type: "password", title: "Password*", placeholder: "Enter customer's password", name: "password", required: true },
			// { type: "checkbox", title: "Show", name: "show" },
		]}
	/>
	<FunctionalFieldset title="Customers">
		<div class="max-h-[70vh] max-w-80">
			{customer.map((item) => (
				<article class="flex !flex-row !gap-3 items-center justify-between">
					<div class="flex flex-col">
						<div class="flex items-center gap-1">
							<h2 class="truncate text-lg font-bold overflow-hidden">
								{item.name}
							</h2>
							<span class="text-xs">
								({item.boxes.length} Boxes)
							</span>
						</div>
						<p class="truncate text-sm">
							{item.description}
						</p>
					</div>
					<form method="post" action={`/api/customer-delete/${item.id}`}>
						<Button submit size="small" typeButton="danger" class="w-min">
							<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
						</Button>
					</form>
					{/*item.show && <span class="text-sm underline underline-offset-4">VISIBLE</span>*/}
				</article>
			))}
		</div>
	</FunctionalFieldset>
</LayoutAdmin>
